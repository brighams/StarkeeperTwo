import {draw_line} from './renderer.js';

const characters = {
  'P': [[0, 0, 0, 1], [0, 0, 0.6, 0], [0.6, 0, 0.6, 0.5], [0.6, 0.5, 0, 0.5]],
  'R': [[0, 0, 0, 1], [0, 0, 0.6, 0], [0.6, 0, 0.6, 0.5], [0.6, 0.5, 0, 0.5], [0.3, 0.5, 0.6, 1]],
  'E': [[0, 0, 0, 1], [0, 0, 0.6, 0], [0, 0.5, 0.4, 0.5], [0, 1, 0.6, 1]],
  'S': [[0.6, 0, 0, 0], [0, 0, 0, 0.5], [0, 0.5, 0.6, 0.5], [0.6, 0.5, 0.6, 1], [0.6, 1, 0, 1]],
  ' ': [],
  'A': [[0, 1, 0.3, 0], [0.3, 0, 0.6, 1], [0.1, 0.6, 0.5, 0.6]],
  'C': [[0.6, 0, 0, 0], [0, 0, 0, 1], [0, 1, 0.6, 1]],
  'B': [[0, 0, 0, 1], [0, 0, 0.5, 0], [0.5, 0, 0.6, 0.1], [0.6, 0.1, 0.6, 0.4], [0.6, 0.4, 0.5, 0.5], [0.5, 0.5, 0, 0.5], [0.5, 0.5, 0.6, 0.6], [0.6, 0.6, 0.6, 0.9], [0.6, 0.9, 0.5, 1], [0.5, 1, 0, 1]],
  'T': [[0, 0, 0.6, 0], [0.3, 0, 0.3, 1]],
  'O': [[0, 0, 0.6, 0], [0.6, 0, 0.6, 1], [0.6, 1, 0, 1], [0, 1, 0, 0]],
  'D': [[0, 0, 0, 1], [0, 0, 0.5, 0], [0.5, 0, 0.6, 0.2], [0.6, 0.2, 0.6, 0.8], [0.6, 0.8, 0.5, 1], [0.5, 1, 0, 1]],
  'F': [[0, 0, 0, 1], [0, 0, 0.6, 0], [0, 0.5, 0.4, 0.5]],
  'G': [[0.6, 0, 0, 0], [0, 0, 0, 1], [0, 1, 0.6, 1], [0.6, 1, 0.6, 0.5], [0.6, 0.5, 0.3, 0.5]],
  'H': [[0, 0, 0, 1], [0.6, 0, 0.6, 1], [0, 0.5, 0.6, 0.5]],
  'I': [[0, 0, 0.6, 0], [0.3, 0, 0.3, 1], [0, 1, 0.6, 1]],
  'J': [[0.6, 0, 0.6, 1], [0.6, 1, 0, 1], [0, 1, 0, 0.7]],
  'K': [[0, 0, 0, 1], [0.6, 0, 0, 0.5], [0, 0.5, 0.6, 1]],
  'L': [[0, 0, 0, 1], [0, 1, 0.6, 1]],
  'M': [[0, 1, 0, 0], [0, 0, 0.3, 0.5], [0.3, 0.5, 0.6, 0], [0.6, 0, 0.6, 1]],
  'N': [[0, 1, 0, 0], [0, 0, 0.6, 1], [0.6, 1, 0.6, 0]],
  'Q': [[0, 0, 0.6, 0], [0.6, 0, 0.6, 1], [0.6, 1, 0, 1], [0, 1, 0, 0], [0.4, 0.7, 0.7, 1.1]],
  'U': [[0, 0, 0, 1], [0, 1, 0.6, 1], [0.6, 1, 0.6, 0]],
  'V': [[0, 0, 0.3, 1], [0.3, 1, 0.6, 0]],
  'W': [[0, 0, 0, 1], [0, 1, 0.3, 0.5], [0.3, 0.5, 0.6, 1], [0.6, 1, 0.6, 0]],
  'X': [[0, 0, 0.6, 1], [0.6, 0, 0, 1]],
  'Y': [[0, 0, 0.3, 0.5], [0.6, 0, 0.3, 0.5], [0.3, 0.5, 0.3, 1]],
  'Z': [[0, 0, 0.6, 0], [0.6, 0, 0, 1], [0, 1, 0.6, 1]],
  '0': [[0, 0, 0.6, 0], [0.6, 0, 0.6, 1], [0.6, 1, 0, 1], [0, 1, 0, 0], [0, 1, 0.6, 0]],
  '1': [[0.15, 0.15, 0.3, 0], [0.3, 0, 0.3, 1], [0, 1, 0.6, 1]],
  '2': [[0, 0, 0.6, 0], [0.6, 0, 0.6, 0.5], [0.6, 0.5, 0, 0.5], [0, 0.5, 0, 1], [0, 1, 0.6, 1]],
  '3': [[0, 0, 0.6, 0], [0.6, 0, 0.6, 1], [0.6, 1, 0, 1], [0, 0.5, 0.6, 0.5]],
  '4': [[0, 0, 0, 0.5], [0, 0.5, 0.6, 0.5], [0.6, 0, 0.6, 1]],
  '5': [[0.6, 0, 0, 0], [0, 0, 0, 0.5], [0, 0.5, 0.6, 0.5], [0.6, 0.5, 0.6, 1], [0.6, 1, 0, 1]],
  '6': [[0.6, 0, 0, 0], [0, 0, 0, 1], [0, 1, 0.6, 1], [0.6, 1, 0.6, 0.5], [0.6, 0.5, 0, 0.5]],
  '7': [[0, 0, 0.6, 0], [0.6, 0, 0.3, 1]],
  '8': [[0, 0, 0.6, 0], [0.6, 0, 0.6, 1], [0.6, 1, 0, 1], [0, 1, 0, 0], [0, 0.5, 0.6, 0.5]],
  '9': [[0, 0.5, 0.6, 0.5], [0, 0, 0, 0.5], [0, 0, 0.6, 0], [0.6, 0, 0.6, 1], [0.6, 1, 0, 1]],
  '.': [[0.25, 0.85, 0.35, 0.85], [0.35, 0.85, 0.35, 1], [0.35, 1, 0.25, 1], [0.25, 1, 0.25, 0.85]],
  '@': [[0.5, 0.5, 0.5, 0.3], [0.5, 0.3, 0.3, 0.3], [0.3, 0.3, 0.3, 0.6], [0.3, 0.6, 0.5, 0.6], [0.5, 0.6, 0.5, 0.8], [0.5, 0.8, 0.1, 0.8], [0.1, 0.8, 0.1, 0.2], [0.1, 0.2, 0.5, 0], [0.5, 0, 0.6, 0.1]]
}

let animationStartTime = null

export const draw_animated_text = (text, x, y, scale, transform, color, duration) => {
  if (animationStartTime === null) {
    animationStartTime = performance.now()
  }

  const elapsed = (performance.now() - animationStartTime) / 1000
  const progress = Math.min(elapsed / duration, 1.0)


  const eased = 1 - Math.pow(1 - progress, 3)

  const currentScale = scale * eased

  if (currentScale > 0.01) {
    draw_text({text, x, y, currentScale, transform, color})
  }
}

export const draw_text = ({text, x, y, scale, transform, color}) => {
  const char_width = 0.8 * scale * 6
  const char_height = scale * 6
  const total_width = text.length * char_width
  let cursor_x = x - total_width / 2

  for (const char of text) {
    const strokes = characters[char]
    if (strokes) {
      for (const stroke of strokes) {
        const x1 = cursor_x + stroke[0] * char_width
        const y1 = y + stroke[1] * char_height
        const x2 = cursor_x + stroke[2] * char_width
        const y2 = y + stroke[3] * char_height
        draw_line({x1, y1, x2, y2, transform, color})
      }
    }
    cursor_x += char_width
  }
}
